"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("@babel/runtime/helpers/extends"),t=require("react"),n=require("dequal/lite");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,i=u(e),c=u(r),o={},l=function(e){return e?o[e]:a},s=function(e){var r=t.useRef(e);return t.useEffect((function(){r.current=e})),r},f=function(e){return e.reduce((function(e,r){return e[r]=!0,e}),{})},d=function(e){return e instanceof FileList},v=function(e){return null!==e&&"object"==typeof e},b=function e(r){if(r instanceof Event)throw new Error("Unable to clone event.");return!v(r)||d(r)?r:r instanceof Date?new Date(r.getTime()):Array.isArray(r)?r.map((function(r){return e(r)})):Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{})},h=function(e){return e.filter(Boolean)},m=function(e){return!Array.isArray(e)&&!(e instanceof Date)&&v(e)},y=function e(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],a=t[n];Array.isArray(u)&&Array.isArray(a)?r[n]=[].concat(u,a):m(u)&&m(a)?r[n]=e(u,a):r[n]=a})),r}),{})},p=function(e){return void 0===e},g=function e(r,t){return m(r)?Object.keys(r).reduce((function(n,u){var a=e(r[u],t[u]||!1);return p(a)?delete n[u]:n[u]=a,n}),{}):t?r:void 0},k=function(e){if("string"!=typeof e)throw new TypeError("Expected a string.");return e.length?h(e.split(/[.[\]]+/)):[]},E=function(e,r,t){if(!m(e)||!r)return t;var n=k(r).reduce((function(e,r){return(e||{})[r]}),e);return p(n)?t:n},C=function(e,r){0},R=function(e){return"function"==typeof e},V=function(e){return R(e)&&"AsyncFunction"===e.constructor.name},A=function(e){return"checkbox"===e.type},S=function(e){return m(e)&&!Object.keys(e).length},D=function(e){return/INPUT|TEXTAREA|SELECT/.test(e.tagName)},O=function(e){return"file"===e.type},T=function(e){return"radio"===e.type},w=function(e){return"select-multiple"===e.type},j=function(e,r,t,n){if(void 0===n&&(n=!1),!m(e))throw new TypeError("Expected an object.");var u=k(r),a=n?b(e):e;return u.slice(0,-1).reduce((function(e,r,t){var n=!Number.isNaN(+u[t+1]);return m(e[r])&&!n||Array.isArray(e[r])&&n||(e[r]=n?[]:{}),e[r]}),a)[u[u.length-1]||""]=t,a},x=function e(r,t,n){if(void 0===n&&(n=!1),!m(r))throw new TypeError("Expected an object.");var u=n?b(r):r,a=u;if(a.hasOwnProperty(t))return delete a[t],u;var i=k(t);if(!i.length)return u;var c=i.pop(),o=i.reduce((function(e,r){return(e||{})[r]}),a);if(Array.isArray(o)){var l=+c;if(l<o.length-1)o.splice(l,1);else for(;l>=0&&(l==c||p(o[l]));)o.splice(l,1),l-=1}else m(o)&&delete o[c];return S(o)||Array.isArray(o)&&!o.length?e(u,i.join(".")):u},F=function(e,r){var u=t.useReducer((function(e){return e+1}),0)[1],a=t.useRef(e),i=t.useRef([{usedState:{},update:u}]),o=s(r||function(){}),l=t.useCallback((function(e,r,t){var u=void 0===t?{}:t,l=u.fieldPath,s=u.shouldUpdate,f=void 0===s||s,d=e.split(".")[0];if(d){if("values"!==e&&"values"===d||!n.dequal(E(a.current,e),r)){var b=j(a.current,e,r,!0),h=b.errors,m=b.dirty,y=b.isDirty,p=b.isValid,g=b.submitCount,k="dirty"===d?function(e){return!!function e(r,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(r);n<u.length;n++){var a=u[n];if(!0===a)return t.push(a),t;v(a)&&e(a,t)}return t}(e).length}(m):y,C="errors"===d?S(h):p,R="isSubmitting"===d&&r?g+=1:g;if(a.current=c.default({},b,{isDirty:k,isValid:C,submitCount:R}),o.current(a.current),!f)return;e=l||e,i.current.forEach((function(r){var t=r.usedState,n=r.update;(Object.keys(t).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||t.isDirty&&k!==y||t.isValid&&C!==p)&&n()}))}}else n.dequal(a.current,r)||(a.current=r,o.current(a.current),i.current.forEach((function(e){var r=e.usedState,t=e.update;f&&!S(r)&&t()})))}),[o]),f=t.useCallback((function(e){i.current[0].usedState=e}),[]),d=t.useCallback((function(e){return i.current.push(e)}),[]),b=t.useCallback((function(e){i.current=i.current.filter((function(r){return r!==e}))}),[]);return{stateRef:a,setStateRef:l,setUsedState:f,subscribeObserver:d,unsubscribeObserver:b}},L=function(e,r){var n=void 0===r?{}:r,u=n.formId,a=i.default(n,["formId"]),o=l(u),s="useFormState";C();var f=t.useRef(),d=t.useReducer((function(e){return e+1}),0)[1],v=o.getFormState,b=o.subscribeObserver,h=o.unsubscribeObserver;return t.useEffect((function(){return b(f.current),function(){return h(f.current)}}),[]),v(e,c.default({},a,{methodName:s,callback:function(e){f.current||(f.current={usedState:e,update:d})}}))};exports.get=E,exports.set=j,exports.unset=x,exports.useControlled=function(e,r){var n,u=void 0===r?{}:r,a=u.formId,o=u.defaultValue,s=u.validate,f=u.parse,d=u.format,v=u.errorWithTouched,b=i.default(u,["formId","defaultValue","validate","parse","format","errorWithTouched"]);C();var h=l(a);C();var m,y=t.useRef(!1),g=L({value:"values."+e,error:"errors."+e,isTouched:"touched."+e,isDirty:"dirty."+e},{formId:a,errorWithTouched:v}),k=h.shouldRemoveField,R=h.defaultValuesRef,V=h.initialStateRef,A=h.controlledsRef,S=h.fieldValidatorsRef,O=h.changedFieldRef,T=h.getNodeValue,w=h.setDefaultValue,j=h.setTouchedMaybeValidate,x=h.handleChangeEvent,F=h.removeField;t.useEffect((function(){return function(){k&&F(e)}}),[e,F,k]),A.current[e]=!0,s&&(S.current[e]=s),p(E(V.current.values,e))&&(m=E(R.current,e),m=p(m)?o:m,p(m)?y.current||(y.current=!0):w(e,m)),m=p(g.value)?m:g.value,m=null!=(n=d?d(m):m)?n:"";var N=b.onChange,P=b.onBlur,W=i.default(b,["onChange","onBlur"]);return[c.default({name:e,value:m,onChange:function(){var r;if(f)r=f.apply(void 0,arguments);else{var t=arguments.length<=0?void 0:arguments[0];r=(null==t?void 0:t.nativeEvent)instanceof Event&&D(t.target)?T(e):t}x(e,r),N&&N.apply(void 0,arguments),O.current=e},onBlur:function(r){j(e),P&&P(r),O.current=void 0}},W),{error:g.error,isTouched:!!g.isTouched,isDirty:!!g.isDirty}]},exports.useForm=function(e){var r=void 0===e?{}:e,u=r.id,l=r.defaultValues,v=void 0===l?{}:l,b=r.validate,k=r.validateOnChange,C=void 0===k||k,L=r.validateOnBlur,N=void 0===L||L,P=r.builtInValidationMode,W=void 0===P?"message":P,q=r.shouldRemoveField,U=void 0===q||q,I=r.excludeFields,M=void 0===I?[]:I,B=r.onReset,_=r.onSubmit,X=r.onError,z=r.debug,G=t.useRef({}),H=t.useRef(),J=t.useRef(),K=t.useRef({}),Q=t.useRef({}),Y=t.useRef({}),Z=t.useRef(f(M)),$=t.useRef(),ee=s(b),re=t.useRef({}),te=s(B||function(){}),ne=s(_||function(){}),ue=s(X||function(){}),ae=t.useRef(v),ie=t.useRef({values:ae.current,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),ce=F(ie.current,z),oe=ce.stateRef,le=ce.setStateRef,se=ce.setUsedState,fe=ce.subscribeObserver,de=ce.unsubscribeObserver,ve=t.useCallback((function(e){var r=e.split("."),t=r[0],n=r[1];le(t,x(oe.current[t],n,!0),{fieldPath:e})}),[le,oe]),be=t.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e,t=r.type,n=r.name,u=r.id,a=r.classList,i=r.dataset.rcfExclude,c=Array.from(a),o=Z.current;return!(/button|image|submit|reset/.test(t)||u&&o["#"+u]||c.find((function(e){return o["."+e]})))&&(!("true"!==i&&!n)&&(Y.current[n]||"true"!==i&&!o[n]))})).reduce((function(e,r){var t,n=r,u=n.name;return e[u]=c.default({},e[u],{field:(null==(t=e[u])?void 0:t.field)||n}),A(n)||T(n)?e[u].options=e[u].options?[].concat(e[u].options,[n]):[n]:(function(e){return"select-one"===e.type}(n)||w(n))&&(e[u].options=Array.from(n.options)),e}),{})}),[]),he=t.useCallback((function(e,r){var t;void 0===r&&(r=K.current);var n=r[e],u=n.field,a=n.options,i=u.value;if("INPUT"===u.tagName){var c,o;if(null!=(c=Q.current[e])&&c.valueAsNumber)return i=u.valueAsNumber;if(null!=(o=Q.current[e])&&o.valueAsDate)return i=u.valueAsDate}if((function(e){return"number"===e.type}(u)||function(e){return"range"===e.type}(u))&&(i=u.valueAsNumber||""),A(u)){var l=a,s=l[0];i=l.length>1?l.filter((function(e){return e.checked})).map((function(e){return e.value})):s.hasAttribute("value")&&s.value?s.checked?[s.value]:[]:s.checked}return T(u)&&(i=(null==(t=a.find((function(e){return e.checked})))?void 0:t.value)||""),w(u)&&(i=a.filter((function(e){return e.selected})).map((function(e){return e.value}))),O(u)&&(i=u.files),i}),[]),me=t.useCallback((function(e,r,t){if(void 0===t&&(t=K.current),t[e]&&!Y.current[e]){var n=t[e],u=n.field,a=n.options;if(A(u)){var i=a;i.length>1?i.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):i[0].checked=!!r}else T(u)?a.forEach((function(e){e.checked=e.value===r})):w(u)&&Array.isArray(r)?a.forEach((function(e){e.selected=!!r.includes(e.value)})):O(u)?(d(r)&&(u.files=r),r||(u.value="")):u.value=null!=r?r:""}}),[]),ye=t.useCallback((function(e,r){ie.current=j(ie.current,"values."+e,r,!0),le("values."+e,r,{shouldUpdate:!1})}),[le]),pe=t.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.shouldUpdateDefaultValues,u=void 0===n||n,a=t.fields;return(void 0===a?Object.values(K.current):a).forEach((function(r){var t=m(r)?r.field.name:r;if(!Y.current[t]){var n=E(e,t);p(n)||me(t,n),u&&(n=E(ae.current,t),ye(t,p(n)?he(t):n))}}))}),[he,ye,me]),ge=t.useCallback((function(e,r){var t=r.target,n=r.errorWithTouched,u=r.defaultValues,a=void 0===u?{}:u,i=(r.methodName,r.callback);if(!e)return i?void 0:oe.current;var c,o={},l=function(e){return e=t?t+"."+e:e,i&&(o[e]=!0),e},s=function(e,r){return e.startsWith("values")?p(r)?(e=e.replace("values.",""),r=E(ae.current,e),p(r)?E(a,e):r):r:n&&e.startsWith("errors")&&r&&!S(r)?(e=e.replace("errors","touched"),o[e]=!0,g(r,E(oe.current,e))):r};if(Array.isArray(e))c=e.map((function(e){return e=l(e),s(e,E(oe.current,e))}));else if(m(e)){var f=e;c=Object.keys(f).reduce((function(r,t){return e=l(f[t]),r[t]=s(e,E(oe.current,e)),r}),{})}else e=l(e),c=s(e,E(oe.current,e));return i&&i(o),c}),[oe]),ke=t.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.target,u=t.errorWithTouched,a=t.defaultValues;return ge(e,{target:n,errorWithTouched:u,defaultValues:a,callback:function(e){return se(e)}})}),[ge,se]),Ee=t.useCallback((function(e,r){return ge(e,{target:r})}),[ge]),Ce=t.useCallback((function(e,r){(r=R(r)?r(E(oe.current.errors,e)):r)?le("errors."+e,r):ve("errors."+e)}),[ve,le,oe]),Re=t.useCallback((function(e){e?Array.isArray(e)?e.forEach((function(e){return Ce(e)})):Ce(e):le("errors",{})}),[Ce,le]),Ve=t.useCallback((function(e){if(!1!==W&&K.current[e]){var r=K.current[e].field;if("message"===W)return r.validationMessage;for(var t in r.validity)if("valid"!==t&&r.validity[t])return t}}),[W]),Ae=t.useCallback((function(){return!1===W?{}:Object.keys(K.current).reduce((function(e,r){var t=Ve(r);return e=c.default({},e,t?j({},r,t):{})}),{})}),[W,Ve]),Se=t.useCallback((async function(e){if(re.current[e])try{return await re.current[e](E(oe.current.values,e),oe.current.values)}catch(e){throw e}}),[oe]),De=t.useCallback((function(){var e=Object.keys(re.current).map((function(e){return Se(e)}));return Promise.all(e).then((function(e){return Object.keys(re.current).reduce((function(r,t,n){return r=c.default({},r,e[n]?j({},t,e[n]):{})}),{})}))}),[Se]),Oe=t.useCallback((async function(e){if(!ee.current)return e?void 0:{};try{var r=await ee.current(oe.current.values);return e?E(r,e):m(r)?r:{}}catch(e){throw e}}),[ee,oe]),Te=t.useCallback((async function(e){var r=V(ee.current)||V(re.current[e]);r&&le("isValidating",!0);try{var t=await Oe(e)||await Se(e)||Ve(e);return Ce(e,t),r&&le("isValidating",!1),t}catch(e){return e}}),[ee,Ve,Se,Oe,Ce,le]),we=t.useCallback((function(e){return r=function(){return Te(e)},(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(r,{timeout:2e3});var r}),[Te]),je=t.useCallback((function(){return le("isValidating",!0),Promise.all([Ae(),De(),Oe()]).then((function(e){var r=y.apply(void 0,e);return le("errors",r),le("isValidating",!1),r}))}),[Ae,De,Oe,le]),xe=t.useCallback((function(e){return e?Array.isArray(e)?Promise.all(e.map((function(e){return Te(e)}))).then((function(e){return!h(e).length})):Te(e).then((function(e){return!e})):je().then((function(e){return S(e)}))}),[Te,je]),Fe=t.useCallback((function(e,r,t){void 0===r&&(r=!0),void 0===t&&(t=N),r?le("touched."+e,!0):ve("touched."+e),t&&we(e)}),[ve,le,we,N]),Le=t.useCallback((function(e){return Fe(e,!0,C?e!==$.current:void 0)}),[Fe,C]),Ne=t.useCallback((function(e,r){void 0===r&&(r=!0),r?le("dirty."+e,!0):ve("dirty."+e)}),[ve,le]),Pe=t.useCallback((function(e){return Ne(e,!n.dequal(E(oe.current.values,e),E(ie.current.values,e)))}),[Ne,oe]),We=t.useCallback((function(e,r,t){var n=void 0===t?{}:t,u=n.shouldValidate,a=void 0===u?C:u,i=n.shouldTouched,c=void 0===i||i,o=n.shouldDirty,l=void 0===o||o;r=R(r)?r(E(oe.current.values,e)):r,p(r)?ve("values."+e):le("values."+e,r),me(e,r),c&&Fe(e,!0,!1),l&&Pe(e),a&&we(e)}),[ve,Pe,me,le,Fe,oe,we,C]),qe=t.useCallback((function(){return{getState:Ee,setValue:We,setTouched:Fe,setDirty:Ne,setError:Ce,clearErrors:Re,runValidation:xe,reset:Ue,submit:Ie}}),[]),Ue=t.useCallback((function(e,r,t){null!=t&&t.preventDefault&&t.preventDefault(),null!=t&&t.stopPropagation&&t.stopPropagation();var n=c.default({},oe.current),u=f(r||[]);Object.keys(n).forEach((function(r){if(!u[r])if("values"===r){var t=(R(e)?e(oe.current.values):e)||ie.current.values;n[r]=t,ie.current=j(ie.current,"values",t,!0),pe(t,{shouldUpdateDefaultValues:!1})}else n[r]=ie.current[r]})),le("",n),te.current(n.values,qe(),t)}),[qe,te,pe,le,oe]),Ie=t.useCallback((async function(e){null!=e&&e.preventDefault&&e.preventDefault(),null!=e&&e.stopPropagation&&e.stopPropagation();var r=Object.keys(c.default({},K.current,Y.current)).reduce((function(e,r){return e=j(e,r,!0,!0)}),oe.current.touched);le("touched",r),le("isSubmitting",!0);try{var t=await je();return S(t)?(await ne.current(oe.current.values,qe(),e),le("isSubmitted",!0),{values:oe.current.values}):(ue.current(t,qe(),e),{errors:t})}catch(e){throw e}finally{le("isSubmitting",!1)}}),[qe,ue,ne,le,oe,je]),Me=t.useCallback((function(e,r){le("values."+e,r),Pe(e),C&&we(e)}),[Pe,le,we,C]),Be=t.useCallback((function(e){ve("values."+e),ve("touched."+e),ve("dirty."+e),ve("errors."+e),ie.current=x(ie.current,"values."+e,!0),delete Q.current[e],delete re.current[e],delete Y.current[e]}),[ve]),_e=t.useCallback((function(e){if(e){J.current=e;var r=J.current;K.current=be(r),pe(ie.current.values),G.current.change=function(e){var r=e.target.name;if(r&&K.current[r]&&!Y.current[r]){var t,n=null==(t=Q.current[r])?void 0:t.parse,u=he(r);Me(r,n?n(u):u),$.current=r}},G.current.blur=function(e){var r=e.target;if(D(r)){var t=r.name;K.current[t]&&!Y.current[t]&&(Le(t),$.current=void 0)}},G.current.submit=function(e){return Ie(e)},G.current.reset=function(e){return Ue(null,null,e)},r.addEventListener("input",G.current.change),r.addEventListener("focusout",G.current.blur),r.addEventListener("submit",G.current.submit),r.addEventListener("reset",G.current.reset),H.current=new MutationObserver((function(e){if("childList"===e[0].type){var t=be(r);U&&Object.keys(K.current).forEach((function(e){var r,n;if(!Y.current[e])if(t[e]){var u=null==(r=K.current[e].options)?void 0:r.length,a=null==(n=t[e].options)?void 0:n.length;u>a?le("values."+e,he(e,t),{shouldUpdate:!1}):u<a&&me(e,E(ie.current.values,e),t)}else Be(e)}));var n=ae.current,u=[];Object.keys(t).forEach((function(e){if(!K.current[e]&&!Y.current[e]){var r=E(oe.current.values,e);p(r)||(n=j(n,e,r,!0)),u.push(e)}})),K.current=t,u.length&&pe(n,{fields:u})}})),H.current.observe(r,{childList:!0,subtree:!0})}}),[be,he,Me,Be,Ue,me,pe,le,Le,U,oe,Ie]),Xe=t.useCallback((function(e){return function(r){if(null!=r&&r.name&&!Y.current[r.name]&&!Z.current[r.name])if(R(e))re.current[r.name]=e;else{var t=e.validate,n=i.default(e,["validate"]);t&&(re.current[r.name]=t),Q.current[r.name]=n}}}),[]);return function(e,r){e?o[e]=r:a=r}(u,{shouldRemoveField:U,defaultValuesRef:ae,initialStateRef:ie,controlledsRef:Y,fieldValidatorsRef:re,changedFieldRef:$,excludeFieldsRef:Z,getNodeValue:he,getFormState:ge,setDefaultValue:ye,setTouchedMaybeValidate:Le,handleChangeEvent:Me,removeField:Be,subscribeObserver:fe,unsubscribeObserver:de,form:_e,field:Xe,select:ke,getState:Ee,setValue:We,setTouched:Fe,setDirty:Ne,setError:Ce,clearErrors:Re,runValidation:xe,reset:Ue,submit:Ie}),t.useEffect((function(){return function(){if(J.current){var e,r=G.current;J.current.removeEventListener("input",r.change),J.current.removeEventListener("focusout",r.blur),J.current.removeEventListener("submit",r.submit),J.current.removeEventListener("reset",r.reset),null==(e=H.current)||e.disconnect()}!function(e){e?delete o[e]:a=void 0}(u)}}),[u]),{form:_e,field:Xe,select:ke,getState:Ee,setValue:We,setTouched:Fe,setDirty:Ne,setError:Ce,clearErrors:Re,runValidation:xe,reset:Ue,submit:Ie}},exports.useFormMethods=function(e){var r=l(e);return C(),{form:r.form,field:r.field,select:r.select,getState:r.getState,setValue:r.setValue,setTouched:r.setTouched,setDirty:r.setDirty,setError:r.setError,clearErrors:r.clearErrors,runValidation:r.runValidation,reset:r.reset,submit:r.submit}},exports.useFormState=L;
//# sourceMappingURL=index.cjs.production.min.js.map
