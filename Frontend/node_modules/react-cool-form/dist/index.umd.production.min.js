!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).ReactCoolForm={},e.React)}(this,(function(e,r){"use strict";function t(){return(t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function n(e,r){if(null==e)return{};var t,n,u={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(u[t]=e[t]);return u}var u,a=Object.prototype.hasOwnProperty;function i(e,r){var t,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((n=e.length)===r.length)for(;n--&&i(e[n],r[n]););return-1===n}if(!t||"object"==typeof e){for(t in n=0,e){if(a.call(e,t)&&++n&&!a.call(r,t))return!1;if(!(t in r)||!i(e[t],r[t]))return!1}return Object.keys(r).length===n}}return e!=e&&r!=r}var c={},o=function(e){return e?c[e]:u},s=function(e){var t=r.useRef(e);return r.useEffect((function(){t.current=e})),t},l=function(e){return e.reduce((function(e,r){return e[r]=!0,e}),{})},f=function(e){return e instanceof FileList},d=function(e){return null!==e&&"object"==typeof e},v=function e(r){if(r instanceof Event)throw new Error("Unable to clone event.");return!d(r)||f(r)?r:r instanceof Date?new Date(r.getTime()):Array.isArray(r)?r.map((function(r){return e(r)})):Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{})},h=function(e){return e.filter(Boolean)},b=function(e){return!Array.isArray(e)&&!(e instanceof Date)&&d(e)},y=function e(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],a=t[n];Array.isArray(u)&&Array.isArray(a)?r[n]=[].concat(u,a):b(u)&&b(a)?r[n]=e(u,a):r[n]=a})),r}),{})},m=function(e){return void 0===e},p=function e(r,t){return b(r)?Object.keys(r).reduce((function(n,u){var a=e(r[u],t[u]||!1);return m(a)?delete n[u]:n[u]=a,n}),{}):t?r:void 0},g=function(e){if("string"!=typeof e)throw new TypeError("Expected a string.");return e.length?h(e.split(/[.[\]]+/)):[]},k=function(e,r,t){if(!b(e)||!r)return t;var n=g(r).reduce((function(e,r){return(e||{})[r]}),e);return m(n)?t:n},E=function(e,r){0},C=function(e){return"function"==typeof e},R=function(e){return C(e)&&"AsyncFunction"===e.constructor.name},A=function(e){return"checkbox"===e.type},V=function(e){return b(e)&&!Object.keys(e).length},O=function(e){return/INPUT|TEXTAREA|SELECT/.test(e.tagName)},T=function(e){return"file"===e.type},S=function(e){return"radio"===e.type},D=function(e){return"select-multiple"===e.type},j=function(e,r,t,n){if(void 0===n&&(n=!1),!b(e))throw new TypeError("Expected an object.");var u=g(r),a=n?v(e):e;return u.slice(0,-1).reduce((function(e,r,t){var n=!Number.isNaN(+u[t+1]);return b(e[r])&&!n||Array.isArray(e[r])&&n||(e[r]=n?[]:{}),e[r]}),a)[u[u.length-1]||""]=t,a},w=function e(r,t,n){if(void 0===n&&(n=!1),!b(r))throw new TypeError("Expected an object.");var u=n?v(r):r,a=u;if(a.hasOwnProperty(t))return delete a[t],u;var i=g(t);if(!i.length)return u;var c=i.pop(),o=i.reduce((function(e,r){return(e||{})[r]}),a);if(Array.isArray(o)){var s=+c;if(s<o.length-1)o.splice(s,1);else for(;s>=0&&(s==c||m(o[s]));)o.splice(s,1),s-=1}else b(o)&&delete o[c];return V(o)||Array.isArray(o)&&!o.length?e(u,i.join(".")):u},F=function(e,n){var u=r.useReducer((function(e){return e+1}),0)[1],a=r.useRef(e),c=r.useRef([{usedState:{},update:u}]),o=s(n||function(){}),l=r.useCallback((function(e,r,n){var u=void 0===n?{}:n,s=u.fieldPath,l=u.shouldUpdate,f=void 0===l||l,v=e.split(".")[0];if(v){if("values"!==e&&"values"===v||!i(k(a.current,e),r)){var h=j(a.current,e,r,!0),b=h.errors,y=h.dirty,m=h.isDirty,p=h.isValid,g=h.submitCount,E="dirty"===v?function(e){return!!function e(r,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(r);n<u.length;n++){var a=u[n];if(!0===a)return t.push(a),t;d(a)&&e(a,t)}return t}(e).length}(y):m,C="errors"===v?V(b):p,R="isSubmitting"===v&&r?g+=1:g;if(a.current=t({},h,{isDirty:E,isValid:C,submitCount:R}),o.current(a.current),!f)return;e=s||e,c.current.forEach((function(r){var t=r.usedState,n=r.update;(Object.keys(t).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||t.isDirty&&E!==m||t.isValid&&C!==p)&&n()}))}}else i(a.current,r)||(a.current=r,o.current(a.current),c.current.forEach((function(e){var r=e.usedState,t=e.update;f&&!V(r)&&t()})))}),[o]),f=r.useCallback((function(e){c.current[0].usedState=e}),[]),v=r.useCallback((function(e){return c.current.push(e)}),[]),h=r.useCallback((function(e){c.current=c.current.filter((function(r){return r!==e}))}),[]);return{stateRef:a,setStateRef:l,setUsedState:f,subscribeObserver:v,unsubscribeObserver:h}},P=function(e,u){var a=void 0===u?{}:u,i=a.formId,c=n(a,["formId"]),s=o(i),l="useFormState";E();var f=r.useRef(),d=r.useReducer((function(e){return e+1}),0)[1],v=s.getFormState,h=s.subscribeObserver,b=s.unsubscribeObserver;return r.useEffect((function(){return h(f.current),function(){return b(f.current)}}),[]),v(e,t({},c,{methodName:l,callback:function(e){f.current||(f.current={usedState:e,update:d})}}))};e.get=k,e.set=j,e.unset=w,e.useControlled=function(e,u){var a,i=void 0===u?{}:u,c=i.formId,s=i.defaultValue,l=i.validate,f=i.parse,d=i.format,v=i.errorWithTouched,h=n(i,["formId","defaultValue","validate","parse","format","errorWithTouched"]);E();var b=o(c);E();var y,p=r.useRef(!1),g=P({value:"values."+e,error:"errors."+e,isTouched:"touched."+e,isDirty:"dirty."+e},{formId:c,errorWithTouched:v}),C=b.shouldRemoveField,R=b.defaultValuesRef,A=b.initialStateRef,V=b.controlledsRef,T=b.fieldValidatorsRef,S=b.changedFieldRef,D=b.getNodeValue,j=b.setDefaultValue,w=b.setTouchedMaybeValidate,F=b.handleChangeEvent,x=b.removeField;r.useEffect((function(){return function(){C&&x(e)}}),[e,x,C]),V.current[e]=!0,l&&(T.current[e]=l),m(k(A.current.values,e))&&(y=k(R.current,e),y=m(y)?s:y,m(y)?p.current||(p.current=!0):j(e,y)),y=m(g.value)?y:g.value,y=null!=(a=d?d(y):y)?a:"";var N=h.onChange,L=h.onBlur,U=n(h,["onChange","onBlur"]);return[t({name:e,value:y,onChange:function(){var r;if(f)r=f.apply(void 0,arguments);else{var t=arguments.length<=0?void 0:arguments[0];r=(null==t?void 0:t.nativeEvent)instanceof Event&&O(t.target)?D(e):t}F(e,r),N&&N.apply(void 0,arguments),S.current=e},onBlur:function(r){w(e),L&&L(r),S.current=void 0}},U),{error:g.error,isTouched:!!g.isTouched,isDirty:!!g.isDirty}]},e.useForm=function(e){var a=void 0===e?{}:e,o=a.id,d=a.defaultValues,v=void 0===d?{}:d,g=a.validate,E=a.validateOnChange,P=void 0===E||E,x=a.validateOnBlur,N=void 0===x||x,L=a.builtInValidationMode,U=void 0===L?"message":L,W=a.shouldRemoveField,I=void 0===W||W,M=a.excludeFields,B=void 0===M?[]:M,q=a.onReset,_=a.onSubmit,X=a.onError,z=a.debug,G=r.useRef({}),H=r.useRef(),J=r.useRef(),K=r.useRef({}),Q=r.useRef({}),Y=r.useRef({}),Z=r.useRef(l(B)),$=r.useRef(),ee=s(g),re=r.useRef({}),te=s(q||function(){}),ne=s(_||function(){}),ue=s(X||function(){}),ae=r.useRef(v),ie=r.useRef({values:ae.current,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),ce=F(ie.current,z),oe=ce.stateRef,se=ce.setStateRef,le=ce.setUsedState,fe=ce.subscribeObserver,de=ce.unsubscribeObserver,ve=r.useCallback((function(e){var r=e.split("."),t=r[0],n=r[1];se(t,w(oe.current[t],n,!0),{fieldPath:e})}),[se,oe]),he=r.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e,t=r.type,n=r.name,u=r.id,a=r.classList,i=r.dataset.rcfExclude,c=Array.from(a),o=Z.current;return!(/button|image|submit|reset/.test(t)||u&&o["#"+u]||c.find((function(e){return o["."+e]})))&&(!("true"!==i&&!n)&&(Y.current[n]||"true"!==i&&!o[n]))})).reduce((function(e,r){var n,u=r,a=u.name;return e[a]=t({},e[a],{field:(null==(n=e[a])?void 0:n.field)||u}),A(u)||S(u)?e[a].options=e[a].options?[].concat(e[a].options,[u]):[u]:(function(e){return"select-one"===e.type}(u)||D(u))&&(e[a].options=Array.from(u.options)),e}),{})}),[]),be=r.useCallback((function(e,r){var t;void 0===r&&(r=K.current);var n=r[e],u=n.field,a=n.options,i=u.value;if("INPUT"===u.tagName){var c,o;if(null!=(c=Q.current[e])&&c.valueAsNumber)return i=u.valueAsNumber;if(null!=(o=Q.current[e])&&o.valueAsDate)return i=u.valueAsDate}if((function(e){return"number"===e.type}(u)||function(e){return"range"===e.type}(u))&&(i=u.valueAsNumber||""),A(u)){var s=a,l=s[0];i=s.length>1?s.filter((function(e){return e.checked})).map((function(e){return e.value})):l.hasAttribute("value")&&l.value?l.checked?[l.value]:[]:l.checked}return S(u)&&(i=(null==(t=a.find((function(e){return e.checked})))?void 0:t.value)||""),D(u)&&(i=a.filter((function(e){return e.selected})).map((function(e){return e.value}))),T(u)&&(i=u.files),i}),[]),ye=r.useCallback((function(e,r,t){if(void 0===t&&(t=K.current),t[e]&&!Y.current[e]){var n=t[e],u=n.field,a=n.options;if(A(u)){var i=a;i.length>1?i.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):i[0].checked=!!r}else S(u)?a.forEach((function(e){e.checked=e.value===r})):D(u)&&Array.isArray(r)?a.forEach((function(e){e.selected=!!r.includes(e.value)})):T(u)?(f(r)&&(u.files=r),r||(u.value="")):u.value=null!=r?r:""}}),[]),me=r.useCallback((function(e,r){ie.current=j(ie.current,"values."+e,r,!0),se("values."+e,r,{shouldUpdate:!1})}),[se]),pe=r.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.shouldUpdateDefaultValues,u=void 0===n||n,a=t.fields;return(void 0===a?Object.values(K.current):a).forEach((function(r){var t=b(r)?r.field.name:r;if(!Y.current[t]){var n=k(e,t);m(n)||ye(t,n),u&&(n=k(ae.current,t),me(t,m(n)?be(t):n))}}))}),[be,me,ye]),ge=r.useCallback((function(e,r){var t=r.target,n=r.errorWithTouched,u=r.defaultValues,a=void 0===u?{}:u,i=(r.methodName,r.callback);if(!e)return i?void 0:oe.current;var c,o={},s=function(e){return e=t?t+"."+e:e,i&&(o[e]=!0),e},l=function(e,r){return e.startsWith("values")?m(r)?(e=e.replace("values.",""),r=k(ae.current,e),m(r)?k(a,e):r):r:n&&e.startsWith("errors")&&r&&!V(r)?(e=e.replace("errors","touched"),o[e]=!0,p(r,k(oe.current,e))):r};if(Array.isArray(e))c=e.map((function(e){return e=s(e),l(e,k(oe.current,e))}));else if(b(e)){var f=e;c=Object.keys(f).reduce((function(r,t){return e=s(f[t]),r[t]=l(e,k(oe.current,e)),r}),{})}else e=s(e),c=l(e,k(oe.current,e));return i&&i(o),c}),[oe]),ke=r.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.target,u=t.errorWithTouched,a=t.defaultValues;return ge(e,{target:n,errorWithTouched:u,defaultValues:a,callback:function(e){return le(e)}})}),[ge,le]),Ee=r.useCallback((function(e,r){return ge(e,{target:r})}),[ge]),Ce=r.useCallback((function(e,r){(r=C(r)?r(k(oe.current.errors,e)):r)?se("errors."+e,r):ve("errors."+e)}),[ve,se,oe]),Re=r.useCallback((function(e){e?Array.isArray(e)?e.forEach((function(e){return Ce(e)})):Ce(e):se("errors",{})}),[Ce,se]),Ae=r.useCallback((function(e){if(!1!==U&&K.current[e]){var r=K.current[e].field;if("message"===U)return r.validationMessage;for(var t in r.validity)if("valid"!==t&&r.validity[t])return t}}),[U]),Ve=r.useCallback((function(){return!1===U?{}:Object.keys(K.current).reduce((function(e,r){var n=Ae(r);return e=t({},e,n?j({},r,n):{})}),{})}),[U,Ae]),Oe=r.useCallback((async function(e){if(re.current[e])try{return await re.current[e](k(oe.current.values,e),oe.current.values)}catch(e){throw e}}),[oe]),Te=r.useCallback((function(){var e=Object.keys(re.current).map((function(e){return Oe(e)}));return Promise.all(e).then((function(e){return Object.keys(re.current).reduce((function(r,n,u){return r=t({},r,e[u]?j({},n,e[u]):{})}),{})}))}),[Oe]),Se=r.useCallback((async function(e){if(!ee.current)return e?void 0:{};try{var r=await ee.current(oe.current.values);return e?k(r,e):b(r)?r:{}}catch(e){throw e}}),[ee,oe]),De=r.useCallback((async function(e){var r=R(ee.current)||R(re.current[e]);r&&se("isValidating",!0);try{var t=await Se(e)||await Oe(e)||Ae(e);return Ce(e,t),r&&se("isValidating",!1),t}catch(e){return e}}),[ee,Ae,Oe,Se,Ce,se]),je=r.useCallback((function(e){return r=function(){return De(e)},(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(r,{timeout:2e3});var r}),[De]),we=r.useCallback((function(){return se("isValidating",!0),Promise.all([Ve(),Te(),Se()]).then((function(e){var r=y.apply(void 0,e);return se("errors",r),se("isValidating",!1),r}))}),[Ve,Te,Se,se]),Fe=r.useCallback((function(e){return e?Array.isArray(e)?Promise.all(e.map((function(e){return De(e)}))).then((function(e){return!h(e).length})):De(e).then((function(e){return!e})):we().then((function(e){return V(e)}))}),[De,we]),Pe=r.useCallback((function(e,r,t){void 0===r&&(r=!0),void 0===t&&(t=N),r?se("touched."+e,!0):ve("touched."+e),t&&je(e)}),[ve,se,je,N]),xe=r.useCallback((function(e){return Pe(e,!0,P?e!==$.current:void 0)}),[Pe,P]),Ne=r.useCallback((function(e,r){void 0===r&&(r=!0),r?se("dirty."+e,!0):ve("dirty."+e)}),[ve,se]),Le=r.useCallback((function(e){return Ne(e,!i(k(oe.current.values,e),k(ie.current.values,e)))}),[Ne,oe]),Ue=r.useCallback((function(e,r,t){var n=void 0===t?{}:t,u=n.shouldValidate,a=void 0===u?P:u,i=n.shouldTouched,c=void 0===i||i,o=n.shouldDirty,s=void 0===o||o;r=C(r)?r(k(oe.current.values,e)):r,m(r)?ve("values."+e):se("values."+e,r),ye(e,r),c&&Pe(e,!0,!1),s&&Le(e),a&&je(e)}),[ve,Le,ye,se,Pe,oe,je,P]),We=r.useCallback((function(){return{getState:Ee,setValue:Ue,setTouched:Pe,setDirty:Ne,setError:Ce,clearErrors:Re,runValidation:Fe,reset:Ie,submit:Me}}),[]),Ie=r.useCallback((function(e,r,n){null!=n&&n.preventDefault&&n.preventDefault(),null!=n&&n.stopPropagation&&n.stopPropagation();var u=t({},oe.current),a=l(r||[]);Object.keys(u).forEach((function(r){if(!a[r])if("values"===r){var t=(C(e)?e(oe.current.values):e)||ie.current.values;u[r]=t,ie.current=j(ie.current,"values",t,!0),pe(t,{shouldUpdateDefaultValues:!1})}else u[r]=ie.current[r]})),se("",u),te.current(u.values,We(),n)}),[We,te,pe,se,oe]),Me=r.useCallback((async function(e){null!=e&&e.preventDefault&&e.preventDefault(),null!=e&&e.stopPropagation&&e.stopPropagation();var r=Object.keys(t({},K.current,Y.current)).reduce((function(e,r){return e=j(e,r,!0,!0)}),oe.current.touched);se("touched",r),se("isSubmitting",!0);try{var n=await we();return V(n)?(await ne.current(oe.current.values,We(),e),se("isSubmitted",!0),{values:oe.current.values}):(ue.current(n,We(),e),{errors:n})}catch(e){throw e}finally{se("isSubmitting",!1)}}),[We,ue,ne,se,oe,we]),Be=r.useCallback((function(e,r){se("values."+e,r),Le(e),P&&je(e)}),[Le,se,je,P]),qe=r.useCallback((function(e){ve("values."+e),ve("touched."+e),ve("dirty."+e),ve("errors."+e),ie.current=w(ie.current,"values."+e,!0),delete Q.current[e],delete re.current[e],delete Y.current[e]}),[ve]),_e=r.useCallback((function(e){if(e){J.current=e;var r=J.current;K.current=he(r),pe(ie.current.values),G.current.change=function(e){var r=e.target.name;if(r&&K.current[r]&&!Y.current[r]){var t,n=null==(t=Q.current[r])?void 0:t.parse,u=be(r);Be(r,n?n(u):u),$.current=r}},G.current.blur=function(e){var r=e.target;if(O(r)){var t=r.name;K.current[t]&&!Y.current[t]&&(xe(t),$.current=void 0)}},G.current.submit=function(e){return Me(e)},G.current.reset=function(e){return Ie(null,null,e)},r.addEventListener("input",G.current.change),r.addEventListener("focusout",G.current.blur),r.addEventListener("submit",G.current.submit),r.addEventListener("reset",G.current.reset),H.current=new MutationObserver((function(e){if("childList"===e[0].type){var t=he(r);I&&Object.keys(K.current).forEach((function(e){var r,n;if(!Y.current[e])if(t[e]){var u=null==(r=K.current[e].options)?void 0:r.length,a=null==(n=t[e].options)?void 0:n.length;u>a?se("values."+e,be(e,t),{shouldUpdate:!1}):u<a&&ye(e,k(ie.current.values,e),t)}else qe(e)}));var n=ae.current,u=[];Object.keys(t).forEach((function(e){if(!K.current[e]&&!Y.current[e]){var r=k(oe.current.values,e);m(r)||(n=j(n,e,r,!0)),u.push(e)}})),K.current=t,u.length&&pe(n,{fields:u})}})),H.current.observe(r,{childList:!0,subtree:!0})}}),[he,be,Be,qe,Ie,ye,pe,se,xe,I,oe,Me]),Xe=r.useCallback((function(e){return function(r){if(null!=r&&r.name&&!Y.current[r.name]&&!Z.current[r.name])if(C(e))re.current[r.name]=e;else{var t=e.validate,u=n(e,["validate"]);t&&(re.current[r.name]=t),Q.current[r.name]=u}}}),[]);return function(e,r){e?c[e]=r:u=r}(o,{shouldRemoveField:I,defaultValuesRef:ae,initialStateRef:ie,controlledsRef:Y,fieldValidatorsRef:re,changedFieldRef:$,excludeFieldsRef:Z,getNodeValue:be,getFormState:ge,setDefaultValue:me,setTouchedMaybeValidate:xe,handleChangeEvent:Be,removeField:qe,subscribeObserver:fe,unsubscribeObserver:de,form:_e,field:Xe,select:ke,getState:Ee,setValue:Ue,setTouched:Pe,setDirty:Ne,setError:Ce,clearErrors:Re,runValidation:Fe,reset:Ie,submit:Me}),r.useEffect((function(){return function(){if(J.current){var e,r=G.current;J.current.removeEventListener("input",r.change),J.current.removeEventListener("focusout",r.blur),J.current.removeEventListener("submit",r.submit),J.current.removeEventListener("reset",r.reset),null==(e=H.current)||e.disconnect()}!function(e){e?delete c[e]:u=void 0}(o)}}),[o]),{form:_e,field:Xe,select:ke,getState:Ee,setValue:Ue,setTouched:Pe,setDirty:Ne,setError:Ce,clearErrors:Re,runValidation:Fe,reset:Ie,submit:Me}},e.useFormMethods=function(e){var r=o(e);return E(),{form:r.form,field:r.field,select:r.select,getState:r.getState,setValue:r.setValue,setTouched:r.setTouched,setDirty:r.setDirty,setError:r.setError,clearErrors:r.clearErrors,runValidation:r.runValidation,reset:r.reset,submit:r.submit}},e.useFormState=P,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.production.min.js.map
